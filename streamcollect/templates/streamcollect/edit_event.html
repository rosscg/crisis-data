{% extends 'streamcollect/base.html' %}

{% block content %}

<div class="container">

  <div class="page-header">
    <h1 class="title"><small>{{ event.name }}</small></h1>
  </div>

  <div class="row">
    <div class="col-sm-8">
      <div class="event_details">
        <form method="POST" class="post-form">{% csrf_token %}
          <p>DateTime Format: YYYY-MM-DD 00:00:00, Timezone: UTC</p>
          {% for f in forms %}
            {% if f.prefix %}
              <p>{{ f.prefix }}</p>
            {% endif %}
            {{ f.as_p }}
          {% endfor %}
          <button type="submit" class="save btn btn-default">Save</button>
        </form>
      </div>
    </div>
  </div>

  <div class="row">
    {% if not mapbox_pk == 'null' %}
    <div id="mapid" style="width: 800px; height: 400px;"></div> </br>
    {% else %}
    Mapbox PK not supplied in config.py, map not shown.
    {% endif %}
  </div>

</div>


<script>

  window.onload = function() {createMap()}

  function createMap() {
    var mymap = L.map('mapid').setView([0, 18], 2);
    var popup = L.popup();
    var mapboxPK = {{ mapbox_pk|safe }};

    //#TODO: Consider hiding PK from source
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=' + mapboxPK, {
  		maxZoom: 18,
  		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
  			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
  			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
  		id: 'mapbox.streets'
  	}).addTo(mymap);

    function onMapClick(e) {
    popup
        .setLatLng(e.latlng)
        .setContent("Clicked at " + e.latlng.toString())
        .openOn(mymap);
      }

    mymap.on('click', onMapClick);
  }

</script>


{% endblock %}
